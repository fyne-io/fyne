<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="icon" type="image/png" href="icon.png">
		<script src="wasm_exec.js"></script>
		{{if not .IsReleased}}
		<script src="webgl-debug.js"></script>
		{{end}}
		<script>
			function webgl_support () {
				try {
					var canvas = document.createElement('canvas');
					return !!window.WebGLRenderingContext &&
						(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
				} catch(e) {
					return false;
				}
			}

			function download_application() {
				var main = document.getElementById("main");

				if (webgl_support()) {
					if (WebAssembly) {
						// WebAssembly.instantiateStreaming is not currently available in Safari
						if (WebAssembly && !WebAssembly.instantiateStreaming) { // polyfill
							WebAssembly.instantiateStreaming = async (resp, importObject) => {
								const source = await (await resp).arrayBuffer();
								return await WebAssembly.instantiate(source, importObject);
							};
						}

						main.innerHTML = "Downloading web assembly file.";

						const go = new Go();
						WebAssembly.instantiateStreaming(fetch("{{.Name}}"), go.importObject).then((result) => {
							main.innerHTML = "";
							go.run(result.instance);
						});
					} else {
						main.innerHTML = "WebAssembly is not supported in your browser";
					}
				} else {
					main.innerHTML = "WebGL is not supported in your browser";
				}
			}
		</script>
	</head>
	<body onload="download_application()">
		<div id="main"></div>
		<noscript>Javascript need to be enable for this application to work.</noscript>
	</body>
</html>
